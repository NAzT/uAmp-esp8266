<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Justpresso Config Web Server">
    <title>Justpresso</title>
    <link rel="stylesheet" href="pure-min.css">
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="side-menu-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="side-menu.css">
    <!--<![endif]-->
    <!--[if lt IE 9]>
    <script src="html5shiv.js"></script>
    <![endif]-->
    <style>
        @media only screen and (min-width: 481px) {
            .form_button {
                text-align: center;
                margin-top: 1.5em;
            }

            .form_item {
                text-align: center;
            }
        }

        #overlay {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            right: 0;
            background: #000;
            opacity: 0.8;
            filter: alpha(opacity=80);
        }

        #loading {
            width: 50px;
            height: 57px;
            position: absolute;
            top: 50%;
            left: 50%;
            margin: -28px 0 0 -25px;
        }
    </style>
    <script src="jquery-3.0.0.min.js"></script>
</head>
<body>
<div id="layout">
    <!-- Menu toggle -->
    <a href="#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>

    <div id="menu">
        <div class="pure-menu">
            <a class="pure-menu-heading">Justpresso</a>

            <ul class="pure-menu-list">
                <li class="pure-menu-item">
                    <a href="/" class="pure-menu-link">WiFi</a>
                </li>

                <li class="pure-menu-item">
                    <a href="justpresso.htm" class="pure-menu-link">Justpresso</a>
                </li>

                <li class="pure-menu-item">
                    <a href="update.htm" class="pure-menu-link">Update Firmware</a>
                </li>

                <li class="pure-menu-item pure-menu-selected">
                    <a href="#" class="pure-menu-link">OTA</a>
                </li>

                <li class="pure-menu-item">
                    <a href="contact.htm" class="pure-menu-link">Contact</a>
                </li>
            </ul>
        </div>
    </div>

    <div id="main">
        <div class="header">
            <h1>OTA Server Setup</h1>
            <h2>Setup OTA Server</h2>
        </div>

        <div class="content">
            <div id="info_panel">
                <p>

                </p>
            </div>
            <h2 class="content-subhead">Please setup OTA Server</h2>
            <p>
                Justpresso will update firmware from OTA server:
            </p>

            <form class="pure-form pure-form-aligned" id="ssid_form" action="#" method="post">
                <fieldset>
                    <div class="pure-control-group">
                        <div class="form_item">
                            <label for="url" style="width: 9em;">OTA Server URL</label>
                            <!--<input id="ssid" name="ssid" type="text" placeholder="SSID">-->
                            <input id="url" name="url" type="text" placeholder="URL" style="width: 16em;">
                            <label for="is_spiffs">is spiffs?</label>
                            <input type="checkbox" name="is_spiffs" id="is_spiffs">
                            </select>
                        </div>
                    </div>


                    <div class="pure-control-group">
                        <div class="form_button">
                            <label for="submit_btn" style="width: 0.5em;"></label>
                            <button id="submit_btn" type="submit" class="pure-button pure-button-primary">Submit</button>

                            <label for="factory_upgrade" style="width: 0.5em;"></label>
                            <button type="submit" id="factory_upgrade" class="pure-button">Factory Upgrade</button>
                        </div>
                    </div>
                </fieldset>
            </form>
            <hr>
            <div id="version_panel">
            </div>
        </div>
    </div>
</div>
<div id="overlay" style='display:block;'>
    <img id="loading" src="loading.gif">
</div>

<script src="ui.js"></script>
<script>
    $(document).ready(function () {

        $("#overlay").hide();

        $("#factory_upgrade").click(function(e) {
            var r = confirm("Upgrade to latest firmware?");
            if (r == true) {
                $.post("/factory_upgrade", function() {
                    $("#overlay").hide();
                });
            } else {
                e.preventDefault();
                return false;
            }
        });


        $("#ssid_form").submit(function (e) {
            $("#overlay").show();
            var url = "/ota"; // the script where you handle the form input.

            $.ajax({
                type: "POST",
                url: url,
                data: $("#ssid_form").serialize(), // serializes the form's elements.
                success: function (data) {
                    $("#overlay").hide();
                    console.log(data);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $("#overlay").hide();
                    alert(xhr.responseText);
                    //alert(thrownError);
                }
            });

            e.preventDefault(); // avoid to execute the actual submit of the form.
        });
    })


</script>
</body>
</html>
